!DOCTYPE html
html lang=ja
head
  meta charset=UTF-8
  meta name=viewport content=width=device-width, initial-scale=1
  titleゆるるチャット - ログインtitle
  script src=httpscdn.jsdelivr.netnpm@supabasesupabase-js@2script
  style
    body { font-family sans-serif; padding 20px; max-width 560px; margin 0 auto; }
    .card { border 1px solid #ccc; background#fafafa; padding 16px; border-radius 12px; }
    input { width 100%; padding 10px; margin 6px 0; box-sizing border-box; }
    button { padding 10px 12px; margin 6px 2px; cursorpointer; }
    .row { displayflex; gap10px; flex-wrap wrap; }
    .hint { font-size 12px; color#666; line-height 1.4; }
    .ok { color#0a7; }
    .ng { color#c33; }
    #log { white-space pre-wrap; font-family ui-monospace, Menlo, monospace; font-size 12px; border1px solid #ddd; padding10px; border-radius10px; background#fff; max-height 160px; overflowauto; }
  style
head
body
  h2ゆるるチャットh2

  div class=card
    b🔐 ログイン  新規登録b
    div class=hintログイン成功したらメインページに移動するよdiv

    input id=email placeholder=メールアドレス autocomplete=email
    input id=pass type=password placeholder=パスワード autocomplete=current-password

    div class=row
      button onclick=signUp()新規登録button
      button onclick=signIn()ログインbutton
    div

    div class=hint style=margin-top8px;
      表示名（あとでメインで変更できる）br
      input id=displayName placeholder=表示名（任意） autocomplete=nickname
      button onclick=saveDisplayName()表示名保存（ログイン後）button
    div

    div id=status class=hint style=margin-top10px;未ログインdiv

    details style=margin-top12px;
      summary🔧 デバッグログsummary
      div id=logdiv
    details
  div

script
 ===== Supabase 設定 =====
const SUPABASE_URL = httpsgqqkjytefyllfomtqcqd.supabase.co;
const SUPABASE_KEY = PUT_YOUR_ANON_KEY_HERE;
const sb = supabase.createClient(SUPABASE_URL.trim(), (SUPABASE_KEY).replace(s+g,));

function log(...args){
  const s = args.map(a = (typeof a === string  a  JSON.stringify(a,null,2))).join( );
  console.log([login], ...args);
  const el = document.getElementById(log);
  el.textContent += s + n;
  el.scrollTop = el.scrollHeight;
}
function setStatus(text, ok=true){
  const el = document.getElementById(status);
  el.className = hint  + (ok  ok  ng);
  el.textContent = text;
}
function showErr(prefix, error){
  log(prefix, error);
  const msg = (error.message  String(error));
  setStatus(prefix +   + msg, false);
  alert(prefix +   + msg);
}

async function gotoMain(){
   ログイン済みならメインへ
  location.href = .index.html;
}

async function signUp(){
  const email = document.getElementById(email).value.trim();
  const pass  = document.getElementById(pass).value;
  if (!email  !pass) return alert(メールとパスワード入れてね！);
  if (pass.length  6) return alert(パスワードは6文字以上にしてね！);

  const { data, error } = await sb.auth.signUp({
    email,
    password pass,
    options { emailRedirectTo httpsyururu-chat.pages.dev }
  });
  if (error) return showErr(新規登録失敗, error);

  log(signUp data, data);
  setStatus(新規登録OK！メール確認が必要なら確認してからログインしてね, true);
}

async function signIn(){
  const email = document.getElementById(email).value.trim();
  const pass  = document.getElementById(pass).value;
  if (!email  !pass) return alert(メールとパスワード入れてね！);

  const { data, error } = await sb.auth.signInWithPassword({ email, password pass });
  if (error) return showErr(ログイン失敗, error);

  log(signIn data, data);
  setStatus(ログインOK！メインへ移動します…, true);
  await gotoMain();
}

async function saveDisplayName(){
  const { data } = await sb.auth.getSession();
  const user = data.session.user;
  if (!user) return alert(先にログインしてね！);
  const dn = document.getElementById(displayName).value.trim();
  if (!dn) return alert(表示名を入れてね！);

  const { error } = await sb.auth.updateUser({ data { display_name dn } });
  if (error) return showErr(表示名保存失敗, error);

  setStatus(表示名を保存した！メインに移動してOK, true);
}

(async()={
  const { data } = await sb.auth.getSession();
  if (data.session.user) {
    setStatus(すでにログイン中！メインへ移動します…, true);
    await gotoMain();
  } else {
    setStatus(未ログイン, true);
  }

  sb.auth.onAuthStateChange(async (_event, session)={
    if (session.user) {
      setStatus(ログイン検知！メインへ移動します…, true);
      await gotoMain();
    }
  });

  log(ready);
})();
script
body
html
